<?phpclass CalenderModel extends CI_Model{    public function __construct()    {        parent::__construct();        $this->load->model('YearModel');        $this->activeyear = $this->session->userdata('current_year');        $this->year_status = $this->YearModel->getYearStatus($this->activeyear);    }    public function save_data($HDate)    {        $this->db->set('IsActive',0);        $this->db->where('IsActive',1);        $this->db->update('calender');        if($this->db->affected_rows() > 0) {            foreach ($HDate as $date){                $this->db->insert('calender',$date);            }            if($this->db->affected_rows() > 0) {                return true;            }else {                return false;            }        }else {            return false;        }    }    public function getAllIds($from,$to)    {        $this->db->select('*');        $this->db->where('id >=', $from);        $this->db->where('id <=', $to);        return $this->db->get('calender')->result();    }    public function getHijriDate($Shdate)    {        $this->db->select('*');        $this->db->where('Sh_date', $Shdate);        return $this->db->get('calender')->result();    }    public function getGeoDate($Qmdate)    {        $this->db->select('*');        $this->db->where('Qm_date', $Qmdate);        return $this->db->get('calender')->result();    }    public function getLastInserted()    {        $this->db->select_max('id');        return $this->db->get('calender')->result();    }    public function update($NewDates,$lenOfIds,$InsertDate,$change = '')    {        for ($i = 0; $i < $lenOfIds; $i++){            if ($change == '1'){                    //  -1                if($i != 1){                    $data = array('Qm_date' => $NewDates[$i]['Qm_date'],                        'day' => $NewDates[$i]['day']);                    $this->db->where('id', $NewDates[$i]['id']);                    $this->db->update('calender', $data);                }            }else{                                  //  +1                $data = array(                    'Qm_date' => $NewDates[$i]['Qm_date'],                    'day' => $NewDates[$i]['day']                );                $this->db->where('id', $NewDates[$i]['id']);                $this->db->update('calender', $data);            }        }        if ($change == '1'){            if($this->db->affected_rows() > 0){                $this->db->delete('calender', array('id' => $InsertDate));                if($this->db->affected_rows() > 0){                    return true;                }else{                    return false;                }            }            else{                return false;            }        }else{            if($this->db->affected_rows() > 0){//                $this->db->insert('calender',$InsertDate);//                if($this->db->affected_rows() > 0){                    return true;//                }else{//                    return false;//                }            }            else{                return false;            }        }    }    public function update_Day($id,$day)    {        $this->db->set('day',$day);        $this->db->where('id',$id);        $this->db->update('calender');        if($this->db->affected_rows() > 0){            return true;        }else{            return false;        }    }    function get_max_date()    {        $max_id = $this->max_id();        $this->db->select('*');        $this->db->where('id', $max_id[0]->id);        return $this->db->get('calender')->result();    }    function get_min_date()    {        $min_id = $this->min_id();        $this->db->select('Sh_date');        $this->db->where('id', $min_id[0]->id);        return $this->db->get('calender')->result();    }    function max_id()    {        $this->db->select_max('id');        if($this->year_status->Active == 1) {        $this->db->where('IsActive', 1);        }else{            $this->db->where('IsActive', 0);        }        return $this->db->get('calender')->result();    }    function min_id()    {        $this->db->select_min('id');        if($this->year_status->Active == 1) {        $this->db->where('IsActive', 1);        }else{            $this->db->where('IsActive', 0);        }        return $this->db->get('calender')->result();    }}