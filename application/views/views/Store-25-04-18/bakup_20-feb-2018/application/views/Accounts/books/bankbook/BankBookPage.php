<link rel="stylesheet" href="<?= base_url()."assets/"; ?>css/jquery-ui.css"><script src="<?= base_url()."assets/"; ?>js/jquery-1.12.4.js"></script><script src="<?= base_url()."assets/"; ?>js/jquery-ui.js"></script><style>    div.dataTables_info{        display: none;    }    div.dataTables_paginate{         display: none;    }    div.dataTables_length label{          display: none;    }    #res {        margin: 0px;        padding-left: 0px;        width: 150px;    }    #res li {        list-style-type: none;    }    #res li:hover {        cursor: pointer;    }    @-moz-document url-prefix() {        .fontchange{            font-family: 'Noto Nastaliq Urdu', serif;        }    }</style><form action="<?= site_url('Accounts/Books/SaveTransaction/');?><?= $this->uri->segment(4);?>/<?= $this->uri->segment(5);?>" method="post">    <div class="row">        <div class="panel-body">            <div class="row">                <div class="col-lg-12">                    <br>                    <br>                    <?php $booktype = $this->uri->segment(4);                    if($booktype == 'br'){?>                        <h1 class="page-header" style="margin-top: 10px;">  بینک وصولی - عارضی واؤچر </h1>                    <?php }else{?>                        <h1 class="page-header" style="margin-top: 10px;">  بینک ادائیگی - عارضی واؤچر </h1>                    <?php }?>                    <input type="hidden" id="url" value="<?= $this->uri->segment(3);?>">                </div>            </div>            <div class="row">                <div class="col-xs-6">                    <div class="form-group" id="shooba"  style="width: 250px; align-content: center;">                        <label class="control-label" for="inputSuccess">شعبہ</label>                        <select class="form-control js-example-basic-single" style="height: 50px;" id="departId" name="departId" autofocus>                            <option value="0" selected> منتخب کریں</option>                            <?php foreach($departments as $department): ?>                                <option class="fontchange" value="<?= $department->Id;?>"><?= $department->DepartmentName; ?></option><?php endforeach ?>                            <select>                    </div>                </div>                <div class="col-xs-6">                    <div class="form-group">                        <label class="control-label" for="inputSuccess">بنام</label>                        <input  class="form-control" id="paidTo" name="paidTo" style="width: 250px;"  type="text">                    </div>                </div>            </div>            <div class="row">                <div class="col-xs-6">                    <div class="form-group" style="width:250px;">                        <label>عیسوی تاریخ</label>                        <div class="form-group">                            <input class="form-control englishDate" type="date" id="" name="englishDate" value="<?= date('Y-m-d'); ?>" placeholder="انگرزیی کی تاریخ منتخب کریں">                        </div>                    </div>                </div>                <div class="col-xs-6">                    <div class="form-group">                        <label class="control-label" for="inputSuccess">ہجری تاریخ</label>                        <input class="form-control islamicDate" id="EislamicDate" name="islamicDate" value="" style="width: 250px;direction: ltr"  type="text" readonly>                    </div>                </div>                <input type="hidden" name="companyId" value="<?= $this->uri->segment(5);?>">            </div>            <div class="row">                <div class="col-xs-6">                    <div class="form-group" style="width:250px;">                        <label>تفصیل</label>                        <textarea class="form-control" rows="3" id="Edetails" name="transac_details"></textarea>                    </div>                </div>                <div class="col-xs-6">                </div>            </div>            <div class="row" style="padding: 10px;">                <button type="submit"  class="btn btn-primary data-save">محفوظ کریں</button>                <button type="button" class="btn btn-primary addbAcc"><i class="fa fa-plus"></i>اکاؤنٹ شامل کریں</button>            </div>        </div>    </div>    <div class="col-lg-12">        <div class="panel panel-default">            <div class="panel-body" style="padding: 0px;">                <div class="container-fluid" >                    <div class="table-responsive">                        <table class="table table-striped table-bordered table-hover" id="dataTables">                            <thead>                                <tr>                                    <th style="text-align: center;width: 13%;">اکاونٹ کا نام</th>                                    <th style="text-align: center;width: 13%;">ڈیبٹ</th>                                    <th style="text-align: center;width: 13%;">کریڈٹ</th>                                    <th style="text-align: center;width: 17%;">چیک نمبر</th>                                    <?php if ($this->uri->segment(4) == 'bp'){?>                                        <th style="text-align: center;width: 13%;">چیک کی تاریخ/ٹیکس ڈیبٹ</th>                                    <?php }else{?>                                        <th style="text-align: center;width: 13%;">چیک کی تاریخ</th>                                    <?php }?>                                    <th style="text-align: center;width: 13%;">تفصیل</th>                                    <th style="text-align: center;width: 8%;"></th>                                </tr>                                <?php foreach ($suppliers as $supplier):?>                                <tr style="display: none">                                    <th class="supp_acc"><?= $supplier->AccountId?></th>                                </tr>                            <?php endforeach;?>                            </thead>                            <tbody id="mytable">                            </tbody>                            <tfoot>                            <tr>                                <th><span style="float: left">کل</span></th>                                <th> <span id="totald"></span></th>                                <th> <span id="totalc"></span></th>                                <th></th>                                <th></th>                                <th></th>                                <th></th>                            </tr>                            </tfoot>                        </table>                    </div>                </div>            </div>        </div>    </div></form><div id="gridSystemModal" class="modal fade"  role="dialog" aria-labelledby="gridModalLabel" aria-hidden="true">    <div class="modal-dialog" role="document">        <div class="modal-content">            <div class="modal-header">                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                <?php $book_type =  $this->uri->segment(4);                if($book_type == 'bp'){?>                    <h4 class="modal-title" id="gridModalLabel"> بینک ادائیگی </h4>                <?php }else{?>                    <h4 class="modal-title" id="gridModalLabel">  بینک وصولی </h4>                <?php }?>            </div>            <div class="modal-body">                <div class="container-fluid bd-example-row">                    <div class="row">                        <div class="col-md-6">                            <div class="form-group">                                <label class="control-label " for="inputSuccess"  >اکاونٹ کا نام</label>                                <select style="width: 100%;padding-top: 0px;padding-bottom: 0px;" id="accountName" class="form-control js-example-basic-single" autofocus>                                    <option value="0"> منتخب کریں</option>                                    <?php foreach($accounts as $account): ?>                                        <option class="fontchange" value="<?= $account->id;?>"><?= $account->parentName.' - '.$account->AccountName; ?></option>                                    <?php endforeach ?>                                </select>                            </div>                        </div>                        <div class="col-md-6 ">                            <div class="form-group">                                <label class="control-label" for="inputSuccess" >اکاونٹ کا کوڈ</label>                                <select style="width: 100%;padding-top: 0px;padding-bottom: 0px;" id="accountCode" class="js-example-basic-single">                                    <option value="0"> منتخب کریں</option>                                    <?php foreach($accounts as $account): ?>                                        <option class="fontchange" value="<?= $account->id;?>"><?= $account->AccountCode; ?></option>                                    <?php endforeach ?>                                </select>                            </div>                        </div>                    </div>                    <div class="row">                        <div class="col-md-6 ">                            <div class="form-group">                                <label class="control-label" for="inputSuccess" >ڈیبٹ</label>                                <input class="form-control recieved" id="recieved" onkeyup="recBlur(this)" type="number" style="width: 100%">                            </div>                        </div>                        <div class="col-md-6">                            <div class="form-group">                                <label class="control-label" for="inputSuccess" >کریڈٹ</label>                                <input class="form-control payment" id="payment"  onkeyup="payBlur(this)"  type="number" style="width: 100%">                            </div>                        </div>                    </div>                    <div class="row" id="chequeData">                        <div class="col-md-6 chequeno">                            <div class="form-group">                                <label class="control-label" for="inputSuccess" >چیک نمبر</label>                                <input class="form-control chequeno" id="chequeno" name="chequeno"  type="text" style="width: 100%">                            </div>                        </div>                        <div class="col-md-6">                            <div class="form-group chequedate">                                <label class="control-label" for="inputSuccess" >چیک کی تاریخ</label>                                <input class="form-control chequedate" id="chequedate" name="chequedate"  type="date" style="width: 100%" value="<?= date('Y-m-d'); ?>">                            </div>                        </div>                    </div>                    <div class="row ser">                        <div class="col-md-12 ">                            <div class="form-group">                                <label class="control-label" for="inputSuccess" >تفصیل</label>                                <textarea class="form-control" rows="3" id="Edetailss" name="details"></textarea>                            </div>                        </div>                    </div>                </div>            </div>            <div class="modal-footer">                <button type="button" id="dataEdit" class="btn btn-primary dataEdit">محفوظ کریں</button>            </div>        </div>    </div></div><script type="text/javascript">    var supp_acc = [];    $( function(){        $('.supp_acc').each(function () {            supp_acc.push($(this).html());        });        console.log(supp_acc);    });    var level = '<?= $this->uri->segment(5);?>';    $( function(){        $.ajax({            type:'GET',            url:'<?= site_url('Accounts/CompanyStructures/GetParentCode')?>'+'/'+level,            success:function(response) {                var data = $.parseJSON(response);                if(data[0]['ParentCode'] != 101)                {                    $('#departId').attr('disabled',true);                    $('#shooba').append('<input type="hidden" name="departId" value="0">');                }            }        });        $('.select2-search--dropdown').attr("id","asd");        $(".addbAcc").click(function () {            var value = $('#Edetails').val();            $('#Edetailss').val(value);            $("#gridSystemModal").modal('show');            $('#chequeData').hide();            $('.dataEdit').removeAttr('disabled');        });        $('#gridSystemModal').on('hidden.bs.modal', function (e) {            $(this)                .find("input,textarea")                .val('')                .end()                .find("input[type=number]")                .prop("disabled", false)                .end();            var dsum = 0;            var csum = 0;            var credit = 0;            var debit = 0;            $('tr').each(function () {                $(this).find('.debit').each(function () {                    var debit = $(this).val();                    if (!isNaN(debit) && debit.length !== 0) {                        dsum += parseFloat(debit);                    }                });                $('#totald').text(dsum);                $(this).find('.credit').each(function () {                    var credit = $(this).val();                    if (!isNaN(credit) && credit.length !== 0) {                        csum += parseFloat(credit);                    }                });                $('#totalc').text(csum);            });        });    });    $('.dataEdit').on('click',function(){        var post = new Object();        post.debit ="";        post.credit ="";        post.name = "";        var error = "";        var rec = $('#recieved').val();        var pay = $('#payment').val();        var id = $('#accountName').val();        if(rec){            var $str  = rec;            var $strlen = $str.length;            var $as = $str.indexOf('.');            var $ap = $str.substring(0,$as);            var $aplen = $ap.length;            $as++;            var $bp = $str.substring($as,$strlen);            var $bplen = $bp.length;        }else{            var $str  = pay;            var $strlen = $str.length;            var $as = $str.indexOf('.');            var $ap = $str.substring(0,$as);            var $aplen = $ap.length;            $as++;            var $bp = $str.substring($as,$strlen);            var $bplen = $bp.length;        }        if($aplen >= 10 || $strlen > 12 || $bplen >= 10){            error = 1;            new PNotify({                title: 'انتباہ',                text: "رقم غلط ہے",                type: 'error',                delay: 3000,                hide: true            });            $(this).removeAttr("data-dismiss","modal");        }        if(!id){            error = 1;            new PNotify({                title: 'انتباہ',                text: " براہ مہربانی  اکاؤنٹ  منتخب کریں",                type: 'error',                delay: 3000,                hide: true            });            $(this).removeAttr("data-dismiss","modal");        }        if(!error){            post.name = '';            // var id = $('#accountName').val();            $.ajax({                type: 'POST',                dataType:  'json',                url:'<?= site_url('Accounts/Books/getAccountCode')?>'+'/'+id,                success:function(response){                    //var data = $.parseJSON(response);                    post.name = response._name;                    post.type = response._type;                }            }).done(function() {                post.is_debit = $('#recieved').val();                if(!post.is_debit == ""){                    post.debit = post.is_debit;                }                post.is_credit = $('#payment').val();                if(!post.is_credit == ""){                    post.credit = post.is_credit;                }                post.details = $('#Edetailss').val();                post.a_id = $('#accountName').val();                post.chequeno = $('.chequeno').val();                post.chequedate = $('#chequedate').val();                var v_type = '<?= $this->uri->segment(4)?>';                if(v_type == 'bp' && post.is_credit == ""){                    if(post.type == 2) {                        $('tbody').append('<tr class="addnew"><td><input class="form-control accountname" name="account[]" type="text" style="width: 100%" readonly value="' + post.name + '"  ></td><td><input class="form-control debit" name="recieved[]" type="text" readonly style="width: 100%" value="' + post.debit + '" ></td><td><input class="form-control credit" name="payment[]" type="text" readonly style="width: 100%" value=' + post.credit + ' ></td><td><input class="form-control recieved" name="bchequeno[]" type="text" style="width: 100%" readonly value=' + post.chequeno + '></td><td><input class="form-control" name="bchequedate[]" type="date" style="display:none" value='+ post.chequedate+'><input class="form-control caldebit" id="caldebit" name="caldebit[]" type="checkbox" style="width: 13%;margin-right: 37%" value="1"></td><td class="center"><textarea class="form-control"   rows="1" name="details[]" readonly >' + post.details + '</textarea></td><td style="display: none"><input type="hidden" class="accountId" name="accountId[]" value=' + post.a_id + '></td><td style="display: none"><input type="hidden" class="accountType" name="" value=' + post.type + '></td><td class="center"><button type="button" class="btn btn-info btn-circle del" ><i class="fa fa-minus"></i></button></td></tr>');                    }else{                        $('tbody').append('<tr class="addnew"><td><input class="form-control accountname" name="account[]" type="text" style="width: 100%" readonly value="' + post.name + '"  ></td><td><input class="form-control debit" name="recieved[]" type="text" readonly style="width: 100%" value="' + post.debit + '" ></td><td><input class="form-control credit" name="payment[]" type="text" readonly style="width: 100%" value="' + post.credit + '" ></td><td><input class="form-control recieved" name="bchequeno[]" type="text" style="width: 100%" readonly value=""  ></td><td><input class="form-control" name="bchequedate[]" type="date" style="display:none" value=""><input class="form-control" name="caldebit[]" type="checkbox" style="width: 13%;margin-right: 37%" value="1"></td><td class="center"><textarea class="form-control"   rows="1" name="details[]" readonly >' + post.details + '</textarea></td><td style="display: none"><input type="hidden" class="accountId" name="accountId[]" value="' + post.a_id + '"></td><td style="display: none"><input type="hidden" class="accountType" name="" value="' + post.type + '"></td><td class="center"><button type="button" class="btn btn-info btn-circle del" ><i class="fa fa-minus"></i></button></td></tr>');                    }                }else{                    if(post.type == 2) {                        $('tbody').append('<tr class="addnew"><td><input class="form-control accountname" name="account[]" type="text" style="width: 100%" readonly value="' + post.name + '"  ></td><td><input class="form-control debit" name="recieved[]" type="text" readonly style="width: 100%" value="' + post.debit + '" ></td><td><input class="form-control credit" name="payment[]" type="text" readonly style="width: 100%" value=' + post.credit + ' ></td><td><input class="form-control recieved" name="bchequeno[]" type="text" style="width: 100%" readonly value=' + post.chequeno + '  ></td><td><input class="form-control recieved" name="bchequedate[]" type="date" style="width: 100%" readonly value=' + post.chequedate + '  ></td><td class="center"><textarea class="form-control"   rows="1" name="details[]" readonly >' + post.details + '</textarea></td><td style="display: none"><input type="hidden" class="accountId" name="accountId[]" value=' + post.a_id + '></td><td style="display: none"><input type="hidden" class="accountType" name="" value=' + post.type + '></td><td class="center"><button type="button" class="btn btn-info btn-circle del" ><i class="fa fa-minus"></i></button></td></tr>');                    }else{                        $('tbody').append('<tr class="addnew"><td><input class="form-control accountname" name="account[]" type="text" style="width: 100%" readonly value="' + post.name + '"  ></td><td><input class="form-control debit" name="recieved[]" type="text" readonly style="width: 100%" value="' + post.debit + '" ></td><td><input class="form-control credit" name="payment[]" type="text" readonly style="width: 100%" value="' + post.credit + '" ></td><td><input class="form-control recieved" name="bchequeno[]" type="text" style="width: 100%" readonly value=""  ></td><td><input class="form-control recieved" name="bchequedate[]" type="date" style="width: 100%" readonly value=""></td><td class="center"><textarea class="form-control"   rows="1" name="details[]" readonly >' + post.details + '</textarea></td><td style="display: none"><input type="hidden" class="accountId" name="accountId[]" value="' + post.a_id + '"></td><td style="display: none"><input type="hidden" class="accountType" name="" value="' + post.type + '"></td><td class="center"><button type="button" class="btn btn-info btn-circle del" ><i class="fa fa-minus"></i></button></td></tr>');                    }                }                $('#gridSystemModal').modal('toggle');            });        }        $('.dataEdit').attr('disabled',true);    });    $( "#dataTables" ).on( "click", ".del", function(e) {        e.preventDefault();        var tr = $(this).parents('tr');        var debit = tr.find('.debit').val();        dsum = $('#totald').text();        var newTotald = dsum - debit;        $('#totald').text(newTotald);        var credit = tr.find('.credit').val();        csum = $('#totalc').text();        var newTotalc = csum - credit;        $('#totalc').text(newTotalc);        $( this ).parents( "tr" ).remove();    });    /**     *  Form Submission here     */    // $('#asd').on('click',function(){    //     $.each(supp_acc, function(index, item) {    //         console.log(item);    //     });    //     $('#mytable').find('input[class="accountId"]').each(function () {    //         console.log($(this).val());    //     });    // });    $("form").submit(function( event ) {        var bookType = '<?= $this->uri->segment(4);?>';        var level = '<?= $this->uri->segment(5);?>';        $.ajax({            type:'GET',            url:'<?= site_url('Accounts/CompanyStructures/GetParentCode')?>'+'/'+level,            success:function(response) {                var data = $.parseJSON(response);                if(data[0]['ParentCode'] == 101)                {                    if($('#departId').val() == null || $('#departId').val() == 0){                        new PNotify({                            title: 'انتباہ',                            text: "شعبہ منتخب کرنا ضروری ہے",                            type: 'error',                            delay: 3000,                            hide: true                        });                        event.preventDefault();                    }                }            }        });        var typeArr = [];        var Accounts = [];        if(bookType == "br"){            var depart = $('#departId').val();            var paid = $('#paidTo').val();            var engDate = $('.englishDate').val();            var islDate = $('.islamicDate').val();            if(!engDate || !islDate){                new PNotify({                    title: 'انتباہ',                    text: "تمام خانے ضروری ہیں",                    type: 'error',                    delay: 3000,                    hide: true                });                event.preventDefault();            }//            var accType;            $('tbody tr').each(function () {                var accType = $(this).find('.accountType').val();                typeArr.push(accType);            });            var count = 1;            $('tbody tr').each(function () {                var accType = $(this).find('.accountType').val();                var debit = $(this).find('.debit').val();                if (accType == 2 && debit.length > 0){                    count = 2;                }            });            if(count == 1){                new PNotify({                    title: 'انتباہ',                    text: "کم از کم ایک بنک بک ڈیبٹ ہونی چاہئے",                    type: 'error',                    delay: 3000,                    hide: true                });                event.preventDefault();            }            var check = 0;            typeArr.forEach(function(e){                if(e == 2){                    check++;                }            });            //alert(check);            if(check > 0){                if($('#totald').text() != $('#totalc').text()){                    new PNotify({                        title: 'انتباہ',                        text: "ڈیبٹ اور کریڈٹ برابر ہونا چاہئے",                        type: 'error',                        delay: 3000,                        hide: true                    });                    event.preventDefault();                }else if(($('#totald').text() == 0) || ($('#totalc').text() == 0)) {                    new PNotify({                        title: 'انتباہ',                        text: "رقم کا اندراج کریں!!!",                        type: 'error',                        delay: 3000,                        hide: true                    });                    event.preventDefault();                }else{                    return;                }            }else{                new PNotify({                    title: 'انتباہ',                    text: "کم از کم ایک بنک بک درکار ہے",                    type: 'error',                    delay: 3000,                    hide: true                });                event.preventDefault();            }        }else if(bookType == "bp"){            var engDate = $('.englishDate').val();            var islDate = $('.islamicDate').val();            if(!engDate || !islDate){                new PNotify({                    title: 'انتباہ',                    text: "تمام خانے ضروری ہیں",                    type: 'error',                    delay: 3000,                    hide: true                });                event.preventDefault();            }            $('tbody tr').each(function () {                var accType = $(this).find('.accountType').val();                typeArr.push(accType);            });            $('tbody tr').each(function () {                var acc = $(this).find('.accountId').val();                Accounts.push(acc);            });            var is_same = 1;            loop:            for (var i = 0; i < Accounts.length; i++) {                for (var j = 0; j < supp_acc.length; j++) {                    if (Accounts[i] == supp_acc[j]) {                        is_same = 0;                        break loop;                    }else{                        is_same = 1                    }                }            }            var IncomeTaxDebit = is_same;            $('#mytable').find('input[type="checkbox"]:checked').each(function () {                IncomeTaxDebit = 1;            });            if (IncomeTaxDebit == 0){                new PNotify({                    title: 'انتباہ',                    text: "انکم ٹیکس کا ڈیبٹ اکاونٹ واضح کریں!",                    type: 'error',                    delay: 3000,                    hide: true                });                event.preventDefault();            }            var variable = 1;            $('tbody tr').each(function () {                var accType = $(this).find('.accountType').val();                var credit = $(this).find('.credit').val();                if (accType == 2 && credit.length > 0){                    variable = 2;                }            });            if(variable == 1){                new PNotify({                    title: 'انتباہ',                    text: "کم از کم ایک بنک بک کریڈٹ ہونی چاہئے",                    type: 'error',                    delay: 3000,                    hide: true                });                event.preventDefault();            }            var check = "";            typeArr.forEach(function(e){                if(e == 2){                    check = 1;                }            });            if(check == 1){                if($('#totald').text() != $('#totalc').text()){                    new PNotify({                        title: 'انتباہ',                        text: "ڈیبٹ اور کریڈٹ برابر ہونا چاہئے",                        type: 'error',                        delay: 3000,                        hide: true                    });                    event.preventDefault();                }else if(($('#totald').text() == 0) || ($('#totalc').text() == 0)) {                    new PNotify({                        title: 'انتباہ',                        text: "رقم اندراج کریں!!!",                        type: 'error',                        delay: 3000,                        hide: true                    });                    event.preventDefault();                }else{                    return;                }            }else{                new PNotify({                    title: 'انتباہ',                    text: "کم از کم ایک بنک بک درکار ہے",                    type: 'error',                    delay: 3000,                    hide: true                });                event.preventDefault();            }        }    });</script>